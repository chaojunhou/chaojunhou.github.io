<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>链接和预编译 | Write the Code</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="" />
    <meta name="author" content="ChaoJun Hou" />
    <meta name="kittycheck_rumble" content="true" />
    <meta name="kittycheck_position" content="top=60,right=60" />

    <!-- Le styles -->
    <link rel="stylesheet" href="../../../../../theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="../../../../../theme/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../../../../../theme/css/font-awesome.css" rel="stylesheet">
    <link href="../../../../../theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../../../../../theme/img/favicon.ico">
    <link rel="apple-touch-icon" href="../../../../../theme/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../../theme/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../../../../theme/img/apple-touch-icon-114x114.png">

    <link href="../../../../../" type="application/atom+xml" rel="alternate" title="Write the Code ATOM Feed" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../../../../../index.html">Write the Code </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li ><a href="../../../../../pages/guan-yu.html">关于</a></li>
                <li class="divider-vertical"></li>
                <li class="active">
                  <a href="../../../../../category/bian-cheng.html">
						        <i class="icon-folder-open icon-large"></i>编程
					         </a>
                </li>
                 <li class="divider-vertical"></li>
                <li >
                  <a href="../../../../../category/ji-suan-ji-ke-xue.html">
						        <i class="icon-folder-open icon-large"></i>计算机科学
					         </a>
                </li>
                 <li class="divider-vertical"></li>
         
              <ul class="nav ">
                    <li><a href="/random.html"><i class="icon-folder-open icon-large"></i>随机文章</a></li>
                    <li class="divider-vertical"></li>
              </ul>
              <ul class="nav">
                    <li><a href="../../../../../archives.html"><i class="icon-th-list"></i>归档</a></li>
                    <li class="divider-vertical"></li>
              </ul>

              <ul class="nav pull-right" style="height: 40px; margin-top: 5px; ">
                    <li >
		              	<form method="get" action="http://www.google.com/search">
		              			<input type="hidden" name="cref" value="" />
  								<input type="hidden" name="ie" value="utf-8" />
  								<input type="hidden" name="hl" value="zh-CN" />
						        <input type="text" name="q" size="40" maxlength="255" placeholder="Search…" />
						        <input type="submit" name="btnG" value="Google Search" />
						        <input type="hidden" name="domains" value="http://www.houcj.net/" />
						        <input type="hidden" name="sitesearch" value="houcj.net" />
						</form>
	              </li>
              </ul>
                      
              
            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
   

    <div class="container">
      <div class="row">
        <div class="span8" id="content">
<div class="row">
    <div class="span2">
        <div class="well">
<footer class="post-info">
<abbr class="published" title="2015-03-27T23:07:00+08:00">
    <i class="icon-calendar"></i>&nbsp;周五 27 三月 2015
</abbr>
<br/><a href="../../../../../author/chaojun-hou.html"><i class="icon-user"></i>&nbsp;ChaoJun Hou</a>


<br/>
	&nbsp;&nbsp;<a href="../../../../../tag/c.html" class="label"><i class="icon-tag"></i>&nbsp;C</a>
</footer><!-- /.post-info -->        </div>
    </div>
    <div class="span6">
<section id="content" class="well">
    <article>
        <header>
            <h1>
                <a href=""
                        rel="bookmark"
                        title="Permalink to 链接和预编译">
                        链接和预编译
                </a>
            </h1>
        </header>
        <div class="entry-content">

        <h2>链接器</h2>
<ul>
<li>分别编译：即若干个源程序可以在不同的时候单独进行编译，然后在恰当的时候将它们整合到一起。但是，链接器一般是与C编译器分离的。</li>
<li>链接器通常把由编译器或汇编器生成的若干个目标模块整合成一个被称为载入模块或可执行文件的实体，该实体能够被操作系统直接执行。</li>
<li>链接器通常把目标模块看成是由一组外部对象组成。每个外部对象代表机器内存中的某个部分，并通过一个外部名称来识别。</li>
<li>exit函数和return函数的主要区别是：<ul>
<li>exit用于在程序运行的过程中随时结束程序，exit的参数返回给操作系统。exit函数运行时会先执行由atexit（）函数等级的函数，然后会做一些自身的清理工作，同时刷新所有输出流、关闭所有打开的流并且关闭通过标准I/O函数tmpfile（）创建的临时文件。exit是结束一个进程，它将删除进程的内存空间，同时讲错误信息返回给父进程。exit是系统调用级别的，表示整个进程的结束。</li>
<li>return表示终止当前函数的运行，并将操作权返回给调用者。如果在main函数中，表示将操作权返回给操作系统，隐式调用exit。​如果return没有值就返回空，表示中断函数的执行，返回调用函数处。return是语言级别的，它表示了调用堆栈的返回；</li>
</ul>
</li>
<li>
<p>理解复杂声明可用的“右左法则”：从变量名看起，先往右，再往左，碰到一个圆括号就调转阅读的方向；括号内分析完就跳出括号，还是按先右后左的顺序，如此循环，直到整个声明分析完。
分析下面的例子，答案见最后。</p>
<div class="highlight"><pre><span class="code-line">char * const *(*next)();</span>
<span class="code-line">char * (* c[10])int (**p);</span>
</pre></div>


<ul>
<li>每个外部对象只在一个地方声明。这个声明的地方一般就在一个头文件中，需要用到该外部对象的所有模块都应该包括在这个头文件。特别注意：定义该外部对应的那个模块也应该包括这个头文件。 </li>
</ul>
</li>
<li>
<p>编译：生成目标平台的指令
-解释：在运行过程中才生成目标平台的指令。需要虚拟机来将编译后生成的中间代码翻译成目标平台的指令。</p>
</li>
<li>
<p>Interposition指用户定义的函数取代函数库中声明<strong><em>完全相同的函数</em></strong>，不是重载.</p>
<div class="highlight"><pre><span class="code-line">void mktemp() {..}</span>
<span class="code-line">void getwd() { mktemp();}</span>
<span class="code-line">int main()</span>
<span class="code-line">{</span>
<span class="code-line">    mktemp();</span>
<span class="code-line">    getwd(); // 即使库函数有 void mktemp(){}，操作系统也会调用用户自己定义的函数</span>
<span class="code-line">    return 0</span>
<span class="code-line">}</span>
</pre></div>


</li>
<li>
<p>链接库的五个特殊秘密</p>
<ul>
<li>动态链接库的扩展名为 ".so"，静态的为".a"</li>
<li>通过-lthread选项，告诉编译器链接到libthread.so</li>
<li>编译器期望在确定的目录下找到这些库函数</li>
<li>观察头文件，确定所使用的函数库</li>
<li>与提取动态库中的符号相比，静态库中的符号提取的方法限制更严格</li>
</ul>
</li>
<li>动态库的优点：<ul>
<li>动态链接可执行文件比功能相同的静态链接可执行文件的体积小。</li>
<li>所有动态链接到某个特定函数库的可执行文件在运行时共享该函数库的一个单独拷贝。  </li>
</ul>
</li>
<li>关于库函数的使用，最好的用法就是尽量使用系统头文件。</li>
</ul>
<h2>预处理</h2>
<ul>
<li>宏定义使用预处理器实现，做一些简单的字符替换因此不能进行参数有效性的检测。</li>
<li>宏定义中的空格不能忽视<div class="highlight"><pre><span class="code-line">    #define f (x) ((x)-1）</span>
</pre></div>


<p>的意思是f代表(x) ((x)-1而不是f(x)代表((x)-1
- 宏定义中出现的括号的作用是预防引起与优先级有关的问题。例如
- 
        #define abs(x) (((x)&gt;=0)?:(x):-(x))// 正确
        #define abs(x) x&gt;0?x:-x // 错误
abs(a-b)在错误的表达式中会展开为 a-b&gt;0?a-b:-a-b
即使是用括号括起来也可能出错。</p>
<div class="highlight"><pre><span class="code-line">    #define max(a,b) ((a)&gt;(b)?(a):(b))</span>
</pre></div>


<p>在上面的表达式中，如果a大于b，那么a将会被求两次值，此时max(a++,b)就会产生错误的结果。
正确的做法如下：</p>
<div class="highlight"><pre><span class="code-line">     #define max(x, y) ({</span>
<span class="code-line">     typeof(x) _max1 = (x);  </span>
<span class="code-line">     typeof(y) _max2 = (y);  </span>
<span class="code-line">     (void) (&amp;_max1 == &amp;_max2);  // 当两个比较两个类型不同的变量的地址时,编译器会给出一个警告.提示我们在进行类型不同的比较.</span>
<span class="code-line">     _max1 &gt; _max2 ? _max1 : _max2; })</span>
</pre></div>


</li>
</ul>
<p>前面的(void)又是干什么用的呢?因为我们在比较两个地址之后并没有保存比较结果,编译器会认为这是一条无效语句,同样会给出一个警告.我们将它转换为(void)类型,编译器会认为我们对结果使用了,就不会提示这个错误。
再看一个经典的例子   </p>
<div class="highlight"><pre><span class="code-line">#define toupper(c)</span>
<span class="code-line">((c)&gt;=&#39;a&#39; &amp;&amp; (c)&lt;=&#39;z&#39;?(c)+(&#39;A&#39;-&#39;a&#39;):(c))</span>
</pre></div>


<p>这样做的原因是因为touppper(函数在调用时造成的系统开销要大大多于函数体内的实际计算操作。</p>
<h2>动态语言和静态语言</h2>
<p>通常我们所说的动态语言、静态语言是指动态类型语言和静态类型语言。</p>
<ul>
<li>
<p>动态类型语言：动态类型语言是指在<strong>运行期间</strong>才去做数据类型检查的语言，也就是说，在用动态类型的语言编程时，永远也不用给任何变量指定数据类型，该语言会在你第一次赋值给变量时，在内部将数据类型记录下来。Python和Ruby就是一种典型的动态类型语言</p>
</li>
<li>
<p>静态类型语言：静态类型语言与动态类型语言刚好相反，它的数据类型是在<strong>编译期间</strong>检查的，也就是说在写程序时要声明所有变量的数据类型，C/C++是静态类型语言的典型代表</p>
</li>
</ul>
<p>一般情况静态类型的语言运行速度要高于动态语言。</p>
<h2>强类型定义语言和弱类型定义语言</h2>
<ul>
<li>
<p>强类型定义语言：强制数据类型定义的语言。也就是说，一旦一个变量被指定了某个数据类型，如果不经过强制转换，那么它就永远是这个数据类型了。举个例子：如果你定义了一个整型变量a,那么程序根本不可能将a当作字符串类型处理。强类型定义语言是类型安全的语言，可以有效的避免许多错误</p>
</li>
<li>
<p>弱类型定义语言：数据类型可以被忽略的语言。它与强类型定义语言相反, 一个变量可以赋不同数据类型的值。</p>
</li>
</ul>
<p>Python是动态的强类型语言，C是静态的弱类型语言</p>
        </div><!-- /.entry-content -->
        <div class="comments">
        <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               var disqus_identifier = "blog/2015/03/27/link-and-preprocess/";
               (function() {
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://houcj.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] ||
                     document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>
    </article>
</section>
</div>
</div>
        </div><!--/span-->
        <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><div><i class="icon-external-link"></i><a href="http://www.rudy-yuan.net/">Rudy-yuan</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="http://www.wengweitao.com">WWT</a></div></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="../../../../../" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="https://twitter.com/chaojunhou"><i class="icon-Twitter-sign icon-large"></i>Twitter</a></li>
    <li><a href="https://www.tumblr.com/blog/houcj"><i class="icon-Tumblr-sign icon-large"></i>Tumblr</a></li>
    <li><a href="https://github.com/chaojunhou"><i class="icon-Github-sign icon-large"></i>Github</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="../../../../../category/bian-cheng.html">
    <i class="icon-folder-open icon-large"></i>编程
</a>
</li>
<li>
<a href="../../../../../category/ji-suan-ji-ke-xue.html">
    <i class="icon-folder-open icon-large"></i>计算机科学
</a>
</li>

<li class="nav-header"><a href="../../../../../tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
    <li class="tag-4">
        <a href="../../../../../tag/duo-xian-cheng.html">
            <i class="icon-tag icon-large"></i>多线程
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/zhi-li.html">
            <i class="icon-tag icon-large"></i>智力
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/tu-xiang.html">
            <i class="icon-tag icon-large"></i>图像
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/sql.html">
            <i class="icon-tag icon-large"></i>SQL
        </a>
    </li>
    <li class="tag-2">
        <a href="../../../../../tag/shu-ju-jie-gou.html">
            <i class="icon-tag icon-large"></i>数据结构
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/zheng-ze-biao-da-shi.html">
            <i class="icon-tag icon-large"></i>正则表达式
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/pa-chong.html">
            <i class="icon-tag icon-large"></i>爬虫
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/yong-sai-kong-zhi.html">
            <i class="icon-tag icon-large"></i>拥塞控制
        </a>
    </li>
    <li class="tag-3">
        <a href="../../../../../tag/tcp.html">
            <i class="icon-tag icon-large"></i>TCP
        </a>
    </li>
    <li class="tag-2">
        <a href="../../../../../tag/c.html">
            <i class="icon-tag icon-large"></i>C
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/shell.html">
            <i class="icon-tag icon-large"></i>SHELL
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/gong-ju.html">
            <i class="icon-tag icon-large"></i>工具
        </a>
    </li>
    <li class="tag-4">
        <a href="../../../../../tag/python.html">
            <i class="icon-tag icon-large"></i>Python
        </a>
    </li>
    <li class="tag-1">
        <a href="../../../../../tag/suan-fa.html">
            <i class="icon-tag icon-large"></i>算法
        </a>
    </li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

    </div><!--/.fluid-container-->

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '61957498']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
     
 

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../../theme/js/jquery-1.7.2.min.js"></script>
    <script src="../../../../../theme/js/bootstrap.min.js"></script>
  </body>

  <!-- hitwebcounter Code START -->

<a href="http://www.hitwebcounter.com/how-to/how-to-what-is-free-blog-counter.php" target="_blank">
<img src="http://hitwebcounter.com/counter/counter.php?page=6046616&style=0005&nbdigits=5&type=ip&initCount=0" title="" Alt=""   border="0" style="float:left">  


  <!-- Baidu Button BEGIN 
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Baidu Button END -->
<!-- UJian Button BEGIN 
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&fade=1"></script>
<!-- UJian Button END -->



</html>